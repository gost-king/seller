/**
â¢€â£€â €â €â €â °â£¶â¡–â ²â ¦â ¤â£¿â£â ²â£¤â£„â¡€â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â ¸â£¿â¡‰â ›â£’â ²â ¾â¡Ÿâ “â ’â ²â¡¾â¢¿â£¿â¢¿â¡¦â£â »â£·â£¤â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â ¹â£Ÿâ¢„â¡ˆâ ™â ¢â ¤â£€â£€â£€â£™â£¦â£™â »â¢¦â£Œâ¡³â „â£¿â£®â£·â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â£¿â¡·â£â¡¢â „â¢°â¡šâ ›â “â ’â ¤â ¬â£¿â¡¶â ¬â¡…â ˜â¢¿â£·â €â£»â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â ¹â£—â£¤â£½â¡¦â „â ™â¢¦â£€â €â €â €â¢»â ˜â£†â¢°â£’â£¦â£¤â£¼â£â¡¿â£†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â ˆâ ™â£¿â¢¯â£”â£’â£€â£ˆâ ¿â ’â£€â¡¤â ’â ‹â ‰â â €â €â €â ‰â£¿â¡˜â¢¦â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â ¿â ·â¢¶â¡žâ ‹â ‰â¢©â ¤â žâ â €â €â €â¢€â£€â£¤â ¤â ²â£žâ£¿â£·â ¸â¡†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â¢¸â£¿â£€â£€â£€â£ â ¤â ¤â –â¢’â£¿â ¿â Ÿâ ›â ‚â €â¢¹â£¿â£¿â €â¢§â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â ¸â£¿â£»â¡ â ¤â£¤â£´â£¦â¡€â ‰â â ´â£¿â Ÿâ €â €â €â£¿â â €â €â ‘â¢„â €â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â¢»â£¿â£‡â €â ›â ›â â£‡â£€â£¤â¡¤â ¤â ¤â ¤â¢°â¡¾â ƒâ €â €â¢€â£€â¡ˆâ¢£â €â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â¢»â£¿â£¤â¡¤â –â£«â µâ¢·â šâ ›â¢»â ‰â£¹â ‹â €â£ â ”â¢Šâ£â¡¤â ¤â Œâ¢§â €â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â ˆâ¢¿â£·â šâ ‰â¢±â €â ¸â¡„â €â£ â Ÿâ â ´â£«â ”â Šâ â €â €â €â €â ˆâ¢¦â €â €â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â €â£¼â£¿â£‡â €â €â ‡â €â£±â žâ â €â¡ â ‹â €â €â €â €â €â €â €â €â €â €â ³â£„â €â €â €â €â €â €â €â €
â €â €â €â €â €â €â €â €â¢ â£¿â£¿â¡¿â£†â €â¢ â žâ â €â¡ â Šâ €â €â €â €â €â €â¢€â£€â£ â£¤â ¤â ”â ’â šâ “â ’â ¤â£„â¡€â €â €â €
â €â €â €â €â €â €â €â£°â£¿â£¿â¡¿â â ˆâ¡¶â ƒâ¢€â¡´â Šâ €â €â €â €â €â£ â ´â šâ ‰â£ â ‹â €â €â €â €â €â €â €â €â €â ™â¢†â €â €
â €â €â €â €â €â €â¢°â£¿â£¿â Ÿâ €â¢€â žâ â â ‹â €â €â €â €â£ â¢´â¡Žâ â €â €â¡´â â €â €â €â €â €â €â €â €â €â €â €â ˆâ¢§â €
â €â €â €â €â €â €â ˆâ¢¿â¡‡â €â¢ â£â£ â žâ €â €â €â¢€â¡´â Šâ â €â ³â €â¢€â¡œâ â €â €â €â €â €â €â €â €â €â €â €â €â €â ˜â¡‡
â €â €â €â €â €â €â €â ˜â£·â €â ¸â ˆâ €â €â¢€â¡¤â –â ‰â €â£ â †â €â €â¢€â¡žâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡‡
â €â €â €â €â €â¢€â¡´â ‹â¢¹â£†â£€â£ â£¤â ’â ™â¡‡â£ â ”â ‹â €â €â €â €â£¸â ‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡‡
â €â €â €â €â €â¡žâ €â¢€â ¼â¡‡â¢°â£¾â£¿â£·â¡´â£Ÿâ â €â €â €â €â €â£°â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡‡
â €â €â €â €â €â£‡â¡´â¢â¡´â£‡â£¨â£¼â£¿â ‹â €â ˆâ €â €â €â €â¢€â¡¼â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â ƒ
â €â €â €â €â €â ‰â €â ˆâ €â ˆâ €â €â ‰â €â €â €â €â €â €â €â ˆâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
 Copyright (C) 2023
 Licensed under the  GPL-3.0 License;
 You may not use this file except in compliance with the License.
 It is supplied in the hope that it may be useful.
 * @project_name : Dark Nero V9
 * @description : Dark Nero V9,A Multi-functional whatsapp bot.
 **/
const axios = require('axios');
const { tlang,cmd } = require('../lib')
const Config = require('../config')
const { redeploy , getvar , delvar , getallvar , change_env , get_deployments} = require('../lib/koyeb')

//----------------------------------------------------------------------------------------------------------------------------------------------------
cmd(
  {
    pattern: "updatenow",
    react: "ðŸŽ‡",
    desc: "update bot with main repo.",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
    async function updatedb() {	
      const simpleGit = require('simple-git')	
          const git = simpleGit();	
        const Heroku = require('heroku-client');	
        const heroku = new Heroku({ token: process.env.HEROKU_API_KEY })	
          await git.fetch();	
              var commits = await git.log(['main' + '..origin/' +'main']);	
              if (commits.total === 0) {	
                return 'Êá´á´œ..Êœá´€á´ á´‡...á´€ÊŸÊ€á´‡á´…Ê..á´œá´˜á´…á´€á´›á´‡á´…...'	
              } else {	
                    var app = await heroku.get('/apps/' + process.env.HEROKU_APP_NAME)	
                   //   await Void.sendMessage(citel.chat,{text:'*á´œá´˜á´…á´€á´›ÉªÉ´É¢...*'})	
                  git.fetch('upstream', 'main');	
                  git.reset('hard', ['FETCH_HEAD']);	
      
                  var git_url = app.git_url.replace(	
                    "https://", "https://api:" + process.env.HEROKU_API_KEY + "@"	
                  )   	
                  try {	
                    await git.addRemote('heroku', git_url);	
                  } catch { console.log('heroku remote adding error'); }	
                  await git.push('heroku', 'main');	
      
                  return '*Ê™á´á´› á´œá´˜á´…á´€á´›á´‡á´…...*\n_Restarting._'	
      
      
              }	
            }	
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        const DB = require('../lib')
        let commits = await DB.syncgit()
        if (commits.total === 0)  {
         citel.reply(`Hey ${citel.pushName}. You have latest version installed.`)
          } else { 
             citel.reply('Build Started...')
            let update = await DB.updatedb()
              citel.reply(update)
          }

       }
       let check = await get_deployments()
       if(check==='true') return citel.reply('_Please wait..._\n_Currently 2 instances are running in Koyeb,wait to stop one of them._')
       let data = await redeploy();
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
cmd(
  {
    pattern: "getvar",
    desc: "get desired var from koyeb.",
    react: "ðŸŽ†",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        if (!text.split(' ')[0]) return citel.reply(`Please Give me var name, ${tlang().greet}`)
        const Heroku = require("heroku-client");
        const heroku = new Heroku({
          token: Config.HEROKU.API_KEY,
        });
        let baseURI = "/apps/" + Config.HEROKU.APP_NAME;
  let h = await heroku.get(baseURI+'/config-vars')
  for (vr in h) {
  if(text.split(' ')[0]===vr) return citel.reply('Your var.\n'+vr+': '+h[vr])	
  }
       }
       if(!text) return citel.reply('Please provide key.\n_Eg: .getvar PORT_')
       let data = await getvar(text);
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
cmd(
  {
    pattern: "getallvar",
    desc: "get all vars from koyeb.",
    react: "ðŸŒ ",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if (Config.heroku=true){
        const Heroku = require("heroku-client");
			const heroku = new Heroku({
				token: Config.HEROKU.API_KEY,
			});
			let baseURI = "/apps/" + Config.HEROKU.APP_NAME;
let h = await heroku.get(baseURI+'/config-vars')
let str = '*All Your Heroku Vars*\n\n'
for (vr in h) {
str+= vr+':'+h[vr]+'\n'
}
citel.reply(str)
       }
       let data = await getallvar();
       return citel.reply(data)
  })
//----------------------------------------------------------------------------------------------------------------------------------------------------
cmd(
  {
    pattern: "delvar",
    desc: "delete var from koyeb.",
    react: "ðŸŽ ",
    filename: __filename,
    category: "misc",
  },
  async (Void,citel,text,{isCreator}) => {
       if(!isCreator) return citel.reply(tlang().owner);
       if(!text) return citel.reply('Please provide key.\n_Eg: .delvar PORT_')
       let check = await get_deployments()
       if(check==='true') return citel.reply('_Please wait..._\n_Currently 2 instances are running in Koyeb,wait to stop one of them._')
       let data = await delvar(text)
       return citel.reply(data)
  })
